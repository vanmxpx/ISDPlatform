/*============================================================================*/
/* DBMS: Oracle 11*/
/* Created on : 3/1/2019 11:42:19 AM                                           */
/*============================================================================*/


/*============================================================================*/
/*                                  TABLES                                    */
/*============================================================================*/
CREATE TABLE USERS (
  IDUSER                    INT NOT NULL,
  NAME                      VARCHAR(40),
  NICKNAME                  VARCHAR(40),
  EMAIL                     VARCHAR(40),
  PASSWORD                  VARCHAR(100) NOT NULL,
  PHOTOURL                  VARCHAR(100),
  ISVERIFIED                VARCHAR2(1) DEFAULT 'n' NOT NULL,
  ISCREATOR                 VARCHAR2(1) DEFAULT 'n' NOT NULL,
  ISBANNED                  VARCHAR2(1) DEFAULT 'n' NOT NULL,
  ENDBANDATE                DATE,
  PLATFORMLANGUAGE          VARCHAR(40),
  PLATFORMTHEME             VARCHAR(40),
CONSTRAINT PK_USERS PRIMARY KEY (IDUSER),
CONSTRAINT CHK_CHECKCONSTRAINT_USERISVERI CHECK (isverified in ('y','n','Y','N')),
CONSTRAINT CHK_CHECKCONSTRAINT_ISCREATOR_ CHECK (iscreator in ('y','n','Y','N')),
CONSTRAINT CHK_CHECKCONSTRAINT_ISBANNED_U CHECK (isbanned in ('y','n','Y','N'))
)
;

CREATE TABLE GAMES (
  IDGAME              INT NOT NULL,
  NAME                VARCHAR(40),
  DESCRIPTION         BLOB,
  GENRE               VARCHAR(40),
  LINK                VARCHAR(100),
  LOGOURL             VARCHAR(100),
  COVERURL            VARCHAR(100),
  IDCREATOR           INT,
  ISVERIFIED          VARCHAR2(1) DEFAULT 'n',
CONSTRAINT PK_GAMES PRIMARY KEY (IDGAME),
CONSTRAINT CHK_CHECKCONSTRAINT_GAMEISVERI CHECK (isverified in ('y','n','Y','N'))
)
;

CREATE TABLE USERSGAMES (
  IDUSERSGAME         INT NOT NULL,
  IDGAME              INT,
  IDUSER              INT,
CONSTRAINT PK_USERSGAMES PRIMARY KEY (IDUSERSGAME),
CONSTRAINT FK_REFERENCE_USERSGAMES_TO_GAME
        FOREIGN KEY (IDGAME)
            REFERENCES GAMES (IDGAME)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_USERSGAMES_TO_USER
        FOREIGN KEY (IDUSER)
            REFERENCES USERS (IDUSER)
ON DELETE CASCADE
)
;

CREATE TABLE CREATORSGAMES (
  IDCREATORSGAME      INT NOT NULL,
  IDGAME              INT,
  IDUSER              INT,
CONSTRAINT PK_CREATORSGAMES PRIMARY KEY (IDCREATORSGAME),
CONSTRAINT FK_REFERENCE_CREATORSGAMES_TO_USER
        FOREIGN KEY (IDUSER)
            REFERENCES USERS (IDUSER)
ON DELETE CASCADE
)
;

CREATE TABLE USERSCONNECTIONS (
  IDUSERSCONNECTION   INT NOT NULL,
  AREFRIENDS          VARCHAR2(1) DEFAULT 'n' NOT NULL,
  BLACKLISTED         VARCHAR2(1) DEFAULT 'n' NOT NULL,
  IDUSER1             INT,
  IDUSER2             INT,
CONSTRAINT PK_USERSCONNECTIONS PRIMARY KEY (IDUSERSCONNECTION),
CONSTRAINT CHK_CHECKCONSTRAINT_AREFRIENDS CHECK (arefriends in ('y','n','Y','N') ),
CONSTRAINT CHK_CHECKCONSTRAINT_BLACKLISTE CHECK (blacklisted in ('y','n','Y','N')),
CONSTRAINT FK_REFERENCE_USERSCONNECTIONS_TO_USER1
        FOREIGN KEY (IDUSER1)
            REFERENCES USERS (IDUSER)
ON DELETE CASCADE
)
;

CREATE TABLE GAMESSTATISTICS (
  IDSTATISTICS        INT NOT NULL,
  IDGAME              INT,
  IDUSER              INT,
  TIMESPENT           DECIMAL(10,3),
  RUNSAMOUNT          INTEGER,
  USERRECORD          INTEGER,
CONSTRAINT PK_GAMESSTATISTICS PRIMARY KEY (IDSTATISTICS),
CONSTRAINT FK_REFERENCE_GAMESSTATISTICS_TO_GAME
        FOREIGN KEY (IDGAME)
            REFERENCES GAMES (IDGAME)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_GAMESSTATISTICS_TO_USER
        FOREIGN KEY (IDUSER)
            REFERENCES USERS (IDUSER)
ON DELETE CASCADE
)
;

CREATE TABLE GAMESREVIEWS (
  IDGAMESREVIEW       INT NOT NULL,
  IDGAME              INT,
  IDREVIEWER          INT,
  CONTENT             BLOB,
  CREATEDATE          DATE,
  RATING              INT,
CONSTRAINT PK_GAMESREVIEWS PRIMARY KEY (IDGAMESREVIEW),
CONSTRAINT FK_REFERENCE_GAMESREVIEWS_TO_GAME
        FOREIGN KEY (IDGAME)
            REFERENCES GAMES (IDGAME)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_GAMESREVIEWS_TO_USER
        FOREIGN KEY (IDREVIEWER)
            REFERENCES USERS (IDUSER)
ON DELETE CASCADE
)
;

CREATE TABLE USERSREVIEWS (
  IDUSERSREVIEW       INT NOT NULL,
  IDREVIEWER          INT,
  IDREVIEWED          INT,
  CONTENT             VARCHAR(200),
  CREATEDATE          DATE,
  RATING              INT,
CONSTRAINT PK_USERSREVIEWS PRIMARY KEY (IDUSERSREVIEW),
CONSTRAINT FK_REFERENCE_USERSREVIEWS_TO_USERS
        FOREIGN KEY (IDREVIEWER)
            REFERENCES USERS (IDUSER)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_USERSREVIEWS_TO_USERSGAMES
        FOREIGN KEY (IDREVIEWED)
            REFERENCES USERSGAMES (IDUSERSGAME)
ON DELETE CASCADE
)
;

CREATE TABLE CHATS (
  IDCHAT              INT NOT NULL,
  CHATNAME            VARCHAR(40),
CONSTRAINT PK_CHATS PRIMARY KEY (IDCHAT)
)
;

CREATE TABLE USERSCHATS (
  IDUSERSCHAT         INT NOT NULL,
  IDUSER              INT,
  IDCHAT              INT,
CONSTRAINT PK_USERSCHATS PRIMARY KEY (IDUSERSCHAT),
CONSTRAINT FK_REFERENCE_USERSCHATS_TO_USER
        FOREIGN KEY (IDUSER)
            REFERENCES USERS (IDUSER)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_USERSCHATS_TO_CHATS
        FOREIGN KEY (IDCHAT)
            REFERENCES CHATS (IDCHAT)
ON DELETE CASCADE
)
;

CREATE TABLE MESSAGES (
  IDMESSAGE           INT NOT NULL,
  IDSENDER            INT,
  IDCHAT              INT,
  CONTENT             VARCHAR(500),
  CREATEDATE          DATE,
  ISREAD              VARCHAR2(1) DEFAULT 'n' NOT NULL,
CONSTRAINT PK_MESSAGES PRIMARY KEY (IDMESSAGE),
CONSTRAINT CHK_CHECKCONSTRAINT_ISREAD_MES CHECK (isread in ('y','n','Y','N')),
CONSTRAINT FK_REFERENCE_MESSAGES_TO_USER
        FOREIGN KEY (IDSENDER)
            REFERENCES USERS (IDUSER),
CONSTRAINT FK_REFERENCE_MESSAGES_TO_CHAT
        FOREIGN KEY (IDCHAT)
            REFERENCES CHATS (IDCHAT)
ON DELETE CASCADE            
)
;