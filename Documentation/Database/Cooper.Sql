/*============================================================================*/
/* DBMS: Oracle 11*/
/* Created on : 3/1/2019 11:42:19 AM                                           */
/*============================================================================*/


/*============================================================================*/
/*                                  TABLES                                    */
/*============================================================================*/
CREATE TABLE USERS (
  ID                        INT NOT NULL,
  NAME                      VARCHAR(40),
  NICKNAME                  VARCHAR(40),
  EMAIL                     VARCHAR(40),
  PASSWORD                  VARCHAR(100) NOT NULL,
  PHOTOURL                  VARCHAR(100),
  ISVERIFIED                VARCHAR2(1) DEFAULT 'n' NOT NULL,
  ISCREATOR                 VARCHAR2(1) DEFAULT 'n' NOT NULL,
  ISBANNED                  VARCHAR2(1) DEFAULT 'n' NOT NULL,
  ENDBANDATE                DATE DEFAULT '13-JAN-2000' NOT NULL,
  PLATFORMLANGUAGE          VARCHAR(40) DEFAULT 'English' NOT NULL,
  PLATFORMTHEME             VARCHAR(40) DEFAULT 'Light' NOT NULL,
CONSTRAINT PK_USERS PRIMARY KEY (ID),
CONSTRAINT CHK_CHECKCONSTRAINT_USERISVERI CHECK (isverified in ('y','n','Y','N')),
CONSTRAINT CHK_CHECKCONSTRAINT_ISCREATOR_ CHECK (iscreator in ('y','n','Y','N')),
CONSTRAINT CHK_CHECKCONSTRAINT_ISBANNED_U CHECK (isbanned in ('y','n','Y','N'))
)
;

CREATE TABLE GAMES (
  ID                  INT NOT NULL,
  NAME                VARCHAR(40),
  DESCRIPTION         VARCHAR(500),
  GENRE               VARCHAR(40),
  LINK                VARCHAR(100),
  LOGOURL             VARCHAR(100),
  COVERURL            VARCHAR(100),
  ISVERIFIED          VARCHAR2(1) DEFAULT 'n',
CONSTRAINT PK_GAMES PRIMARY KEY (ID),
CONSTRAINT CHK_CHECKCONSTRAINT_GAMEISVERI CHECK (isverified in ('y','n','Y','N'))
)
;

CREATE TABLE USERSGAMES (
  ID                  INT NOT NULL,
  IDGAME              INT,
  IDUSER              INT,
CONSTRAINT PK_USERSGAMES PRIMARY KEY (ID),
CONSTRAINT FK_REFERENCE_USERSGAMES_TO_GAME
        FOREIGN KEY (IDGAME)
            REFERENCES GAMES (ID)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_USERSGAMES_TO_USER
        FOREIGN KEY (IDUSER)
            REFERENCES USERS (ID)
ON DELETE CASCADE
)
;

CREATE TABLE CREATORSGAMES (
  ID                  INT NOT NULL,
  IDGAME              INT,
  IDUSER              INT,
CONSTRAINT PK_CREATORSGAMES PRIMARY KEY (ID),
CONSTRAINT FK_REFERENCE_CREATORSGAMES_TO_USER
        FOREIGN KEY (IDUSER)
            REFERENCES USERS (ID)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_CREATORSGAMES_TO_GAME
        FOREIGN KEY (IDGAME)
            REFERENCES GAMES (ID)
ON DELETE CASCADE
)
;

CREATE TABLE USERSCONNECTIONS (
  ID                  INT NOT NULL,
  AREFRIENDS          VARCHAR2(1) DEFAULT 'n' NOT NULL,
  BLACKLISTED         VARCHAR2(1) DEFAULT 'n' NOT NULL,
  IDUSER1             INT NOT NULL,
  IDUSER2             INT NOT NULL,
CONSTRAINT PK_USERSCONNECTIONS PRIMARY KEY (ID),
CONSTRAINT CHK_CHECKCONSTRAINT_AREFRIENDS CHECK (arefriends in ('y','n','Y','N') ),
CONSTRAINT CHK_CHECKCONSTRAINT_BLACKLISTE CHECK (blacklisted in ('y','n','Y','N')),
CONSTRAINT FK_REFERENCE_USERSCONNECTIONS_TO_USER1
        FOREIGN KEY (IDUSER1)
            REFERENCES USERS (ID)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_USERSCONNECTIONS_TO_USER2
        FOREIGN KEY (IDUSER2)
            REFERENCES USERS (ID)
ON DELETE CASCADE
)
;

CREATE TABLE GAMESSTATISTICS (
  ID                  INT NOT NULL,
  IDGAME              INT NOT NULL,
  IDUSER              INT NOT NULL,
  TIMESPENT           DECIMAL(10,3),
  RUNSAMOUNT          INTEGER,
  USERRECORD          INTEGER,
CONSTRAINT PK_GAMESSTATISTICS PRIMARY KEY (ID),
CONSTRAINT FK_REFERENCE_GAMESSTATISTICS_TO_GAME
        FOREIGN KEY (IDGAME)
            REFERENCES GAMES (ID)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_GAMESSTATISTICS_TO_USER
        FOREIGN KEY (IDUSER)
            REFERENCES USERS (ID)
ON DELETE CASCADE
)
;

CREATE TABLE GAMESREVIEWS (
  ID                  INT NOT NULL,
  IDGAME              INT NOT NULL,
  IDREVIEWER          INT NOT NULL,
  CONTENT             VARCHAR(500),
  CREATEDATE          DATE,
  RATING              INT,
CONSTRAINT PK_GAMESREVIEWS PRIMARY KEY (ID),
CONSTRAINT FK_REFERENCE_GAMESREVIEWS_TO_GAME
        FOREIGN KEY (IDGAME)
            REFERENCES GAMES (ID)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_GAMESREVIEWS_TO_USER
        FOREIGN KEY (IDREVIEWER)
            REFERENCES USERS (ID)
ON DELETE CASCADE
)
;

CREATE TABLE USERSREVIEWS (
  ID                  INT NOT NULL,
  IDREVIEWER          INT NOT NULL,
  IDREVIEWED          INT NOT NULL,
  CONTENT             VARCHAR(200),
  CREATEDATE          DATE,
  RATING              INT,
CONSTRAINT PK_USERSREVIEWS PRIMARY KEY (ID),
CONSTRAINT FK_REFERENCE_USERSREVIEWS_TO_REVIEWER
        FOREIGN KEY (IDREVIEWER)
            REFERENCES USERS (ID)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_USERSREVIEWS_TO_REVIEWED
        FOREIGN KEY (IDREVIEWED)
            REFERENCES USERS (ID)
ON DELETE CASCADE
)
;

CREATE TABLE CHATS (
  ID                  INT NOT NULL,
  CHATNAME            VARCHAR(40),
CONSTRAINT PK_CHATS PRIMARY KEY (ID)
)
;

CREATE TABLE USERSCHATS (
  ID                  INT NOT NULL,
  IDUSER              INT NOT NULL,
  IDCHAT              INT NOT NULL,
CONSTRAINT PK_USERSCHATS PRIMARY KEY (ID),
CONSTRAINT FK_REFERENCE_USERSCHATS_TO_USER
        FOREIGN KEY (IDUSER)
            REFERENCES USERS (ID)
ON DELETE CASCADE,
CONSTRAINT FK_REFERENCE_USERSCHATS_TO_CHAT
        FOREIGN KEY (IDCHAT)
            REFERENCES CHATS (ID)
ON DELETE CASCADE
)
;

CREATE TABLE MESSAGES (
  ID                  INT NOT NULL,
  IDSENDER            INT NOT NULL,
  IDCHAT              INT NOT NULL,
  CONTENT             VARCHAR(500),
  CREATEDATE          DATE,
  ISREAD              VARCHAR2(1) DEFAULT 'n' NOT NULL,
CONSTRAINT PK_MESSAGES PRIMARY KEY (ID),
CONSTRAINT CHK_CHECKCONSTRAINT_ISREAD_MES CHECK (isread in ('y','n','Y','N')),
CONSTRAINT FK_REFERENCE_MESSAGES_TO_USER
        FOREIGN KEY (IDSENDER)
            REFERENCES USERS (ID),
CONSTRAINT FK_REFERENCE_MESSAGES_TO_CHAT
        FOREIGN KEY (IDCHAT)
            REFERENCES CHATS (ID)
ON DELETE CASCADE            
)
;